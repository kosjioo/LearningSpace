name: Daily Update Email with Notes

on:
  schedule:
    - cron: '0 23 * * *'  # UTC 23ç‚¹è§¦å‘ï¼ŒåŒ—äº¬æ—¶é—´7ç‚¹
  workflow_dispatch:        # æ”¯æŒæ‰‹åŠ¨è¿è¡Œ

jobs:
  send-email:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Find yesterday's updated Markdown files
        id: find_files
        run: |
          YESTERDAY=$(date -d "yesterday" +%Y-%m-%d)
          echo "Yesterday was: $YESTERDAY"
          git log --since="$YESTERDAY 00:00" --until="$YESTERDAY 23:59" --pretty=format: --name-only | grep '\.md$' | sort -u > md_files.txt
          if [ ! -s md_files.txt ]; then
            echo "æ˜¨å¤©æ²¡æœ‰æ›´æ–° Markdown ç¬”è®°ã€‚" > body.txt
          else
            echo "ğŸ“˜ æ˜¨æ—¥å­¦ä¹ ç¬”è®°\n" > body.txt
            for file in $(cat md_files.txt); do
              echo -e "\n\n## æ–‡ä»¶: $file\n" >> body.txt
              cat "$file" >> body.txt
            done
          fi

      - name: Send email notification
        uses: dawidd6/action-send-mail@v2
        with:
          server_address: smtp.office365.com
          server_port: 587
          username: ${{ secrets.OUTLOOK_USERNAME }}
          password: ${{ secrets.OUTLOOK_PASSWORD }}
          subject: ğŸ“˜ æ˜¨æ—¥å­¦ä¹ ç¬”è®° (è‡ªåŠ¨å‘é€)
          to: jiahui.a.li@outlook.com
          from: jiahui.a.li@outlook.com
          content_type: text/plain
          body: |
            $(cat body.txt)
